# Manual started workflow
name: e2e
on: workflow_dispatch
jobs:
  cypress-run:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v3
      - name: Cache node modules
        id: cache-npm
        uses: actions/cache@v3
        env:
          cache-name: cache-node-modules
        with:
          # npm cache files are stored in `~/.npm` on Linux/macOS
          path: ~/.npm
          key: ${{ runner.os }}-build-${{ env.cache-name }}-${{ hashFiles('**/package-lock.json') }}
          restore-keys: |
            ${{ runner.os }}-build-${{ env.cache-name }}-
            ${{ runner.os }}-build-
            ${{ runner.os }}-

      - if: ${{ steps.cache-npm.outputs.cache-hit != 'true' }}
        name: List the state of node modules
        continue-on-error: true
        run: npm list        
      - name: Install-Deps  
        run: |
          cd tool-guidance/testing
          npm install --save-dev typescript
          npm install --save-dev cypress
          npm install --force --save-dev cypress-keycloak 
          npm install --force --save-dev cypress-file-upload
          npm install --force --save-dev @faker-js/faker
          npm install --force --save-dev cypress-plugin-api
      - name: E2E Smoke tests
        uses: cypress-io/github-action@v5
        id: smoke
        # Continue the build in case of an error, as we need to set the
        # commit status in the next step, both in case of success and failure
        continue-on-error: true
        with:
        # No recording of results in the cloud
          record: false
          working-directory: tool-guidance/testing
        env:
          CYPRESS_BASE_URL: ${{ secrets.CYPRESS_HOST }}
          CYPRESS_host: ${{ secrets.CYPRESS_HOST }}
          CYPRESS_username: ${{ secrets.CYPRESS_USER_NAME }}
          CYPRESS_password: ${{ secrets.CYPRESS_PASSWORD }}
